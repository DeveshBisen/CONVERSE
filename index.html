<!-- WebRTC Conference Project -->
<!DOCTYPE html>
<html lang="en">
    <head>	
        <title>Airbus Flight Booking</title>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <link rel="stylesheet" href="mystyle.css">
		<link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet"> 
        <link href="https://fonts.googleapis.com/css?family=Racing+Sans+One" rel="stylesheet">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    </head>
    <body>
        <br>
        <header style="text-align: center;"> 
            <h1 class="style1" >
                Flight Booking
            </h1>
        </header>

        <div class="container" >
        <div class="col-3">
        <h2> Source </h2> <input type="text" id="flight-source" placeholder="Source" class="form-control input-sm">
        </div>

        <div class="col-3">
        <h2> Destination </h2> <input type="text" id="flight-destination" placeholder="Destination" class="form-control input-sm">
        </div>

        <div class="col-3">
            <br>
            <button type="button" id="search-flight" class="btn btn-primary" onClick="searchFlights()">Search Flights</button>
        </div>
        </div>
        <br>

        <div class="container" >
            <br>
            <div class="col-9">
            <ul id="flights"></ul>
            </div>
        </div>

        <div class="container" >
            <br>
            <div class="col-6">
                <input type="text" id="booking_flight_id" placeholder="Flight Code" class="form-control input-sm">
                <br>
                <input type="text" id="voucher_code" placeholder="Voucher Code" class="form-control input-sm">
                <br>
                <button class="btn btn-danger" id="book_flight" onClick="bookFlight();"> Book Flight </button>
            </div>
        </div>

        
        <div class="container" >
        <br>
        <div class="col-3">
                <br>
                <button type="button" class="btn btn-primary" onClick="window.location = 'contactsupport.html'">Contant Support    </button>
        </div>
        </div>

        <script>

            function bookFlight() {
                var voucheCode = document.getElementById("voucher_code").value;
                var flightID = document.getElementById("booking_flight_id").value;
                
                const url = "https://convereinviteapi.herokuapp.com/flight/"+voucheCode+"$"+flightID;

                var request = new XMLHttpRequest()
                request.open('GET', url, true)
                request.onload = function() {
                    var data = JSON.parse(this.response)
                    if (request.status >= 200 && request.status < 400) {
                        console.log(data);
                        if (data == "bookingsuccessfull") {
                            alert("Booking Successfull");
                        } else {
                            alert("Invalid Voucher Code");
                        }
                    } else {
                        alert("Something unexpected happened");
                        console.log('error')
                    }
                }
                request.send()
            }

            function createNode(element) {
                return document.createElement(element);
            }

            function append(parent, el) {
                return parent.appendChild(el);
            }

            function searchFlights() {
                var source = document.getElementById("flight-source").value;
                var destination = document.getElementById("flight-destination").value;   
        
                const ul = document.getElementById('flights');

                const url = "https://convereinviteapi.herokuapp.com/flight/"+source+"$"+destination;

                var request = new XMLHttpRequest()
                request.open('GET', url, true)
                request.onload = function() {
                    var data = JSON.parse(this.response)
                    if (request.status >= 200 && request.status < 400) {
                        data.forEach(flight => {
                            let li = createNode('li'), 
                            span = createNode('span');
                            span.innerHTML = `ID - ${flight[5]} SOURCE - ${flight[0]}  DESTINATION - ${flight[1]}  DEPARTURE - ${flight[2]}   ARRIVAL - ${flight[3]}   FARE(In INR) - ${flight[4]}`;
                            append(li, span);
                            append(ul, li);
                        })
                    } else {
                        alert("Something unexpected happened");
                        console.log('error')
                    }
                }
                request.send()
            }  
        </script>
    </body>
</html>
